# Anonymous Messenger Penetration Testing Tool

This tool demonstrates the security and anonymity of the Anonymous Terminal Messenger by showing what data can and cannot be observed through various network analysis techniques.

## Purpose

The penetration testing tool serves as proof-of-concept to demonstrate:

-   What network traffic is visible to observers
-   How the messenger's security measures protect against common attacks
-   Traffic analysis resistance and correlation attack prevention
-   Tor infrastructure security assessment

## Features

### Network Traffic Analysis

-   **Packet Capture**: Real-time network packet interception
-   **Traffic Pattern Analysis**: Timing, size, and flow analysis
-   **Tor Traffic Detection**: Identification of Tor-related communications
-   **Connection Mapping**: Analysis of network connections and patterns

### Security Assessment

-   **Tor Infrastructure Analysis**: Detection and configuration assessment
-   **Correlation Attack Simulation**: Traffic correlation vulnerability testing
-   **Timing Analysis**: Detection of regular patterns that could aid attacks
-   **Padding Detection**: Verification of message padding effectiveness

### Reporting

-   **Real-time Display**: Live security analysis with Rich UI
-   **Security Scoring**: Numerical security assessment (0-100)
-   **Detailed Reports**: JSON export of all findings
-   **Recommendations**: Specific security improvement suggestions

## Installation

### Prerequisites

```bash
# Install system dependencies (Ubuntu/Debian)
sudo apt-get update
sudo apt-get install python3-dev libpcap-dev

# Install system dependencies (macOS)
brew install libpcap

# Install Python dependencies
pip install -r pentest_requirements.txt
```

### Required Permissions

The tool requires root/administrator privileges for packet capture:

```bash
# Linux/macOS
sudo python3 pentest_anon_messenger.py

# Or add capabilities (Linux only)
sudo setcap cap_net_raw,cap_net_admin=eip /usr/bin/python3
```

## Usage

### Basic Usage

```bash
# Run comprehensive security test (60 seconds)
sudo python3 pentest_anon_messenger.py

# Quick test (30 seconds)
sudo python3 pentest_anon_messenger.py --quick

# Custom duration
sudo python3 pentest_anon_messenger.py --duration 120

# Specify network interface
sudo python3 pentest_anon_messenger.py --interface eth0

# Generate detailed report
sudo python3 pentest_anon_messenger.py --report security_analysis.json
```

### Testing Workflow

1. **Start the Anonymous Messenger** (in separate terminal):

    ```bash
    python3 anon_messenger.py --server
    ```

2. **Run the Pentest Tool** (requires root):

    ```bash
    sudo python3 pentest_anon_messenger.py --duration 60
    ```

3. **Connect Clients** (in separate terminals):

    ```bash
    python3 anon_messenger.py --client "onion_address:key"
    ```

4. **Send Messages** to generate traffic for analysis

5. **Review Results** in the pentest tool output

## Analysis Phases

### Phase 1: Tor Infrastructure Analysis

**What it checks:**

-   Tor process detection and configuration
-   Port analysis (SOCKS, Control ports)
-   Tor connectivity testing
-   Security configuration assessment

**Expected Results:**

-   ✓ Tor processes running
-   ✓ SOCKS proxy functional
-   ✓ Secure configuration detected

### Phase 2: Network Traffic Analysis

**What it captures:**

-   All TCP packets on specified interface
-   Packet timing and size patterns
-   Connection establishment and teardown
-   Tor-specific traffic identification

**What it analyzes:**

-   Traffic volume and patterns
-   Message size distribution
-   Timing regularity
-   Padding effectiveness

### Phase 3: Security Assessment

**Scoring Criteria:**

-   **Tor Infrastructure (30 points)**: Proper Tor setup and connectivity
-   **Traffic Analysis (40 points)**: Padding, timing obfuscation, Tor usage
-   **Correlation Risk (30 points)**: Resistance to traffic correlation attacks

**Grade Scale:**

-   A (90-100): Excellent security
-   B (80-89): Good security
-   C (70-79): Adequate security
-   D (60-69): Poor security
-   F (0-59): Inadequate security

## What the Tool Demonstrates

### Observable Data (What Attackers Can See)

1. **Network Metadata:**

    - Connection timestamps
    - Packet sizes and timing
    - Traffic volume
    - Tor usage (but not destinations)

2. **Traffic Patterns:**
    - Communication frequency
    - Burst patterns
    - Connection durations

### Protected Data (What Attackers Cannot See)

1. **Message Content:**

    - All messages are encrypted end-to-end
    - No plaintext content visible

2. **Real IP Addresses:**

    - All traffic routed through Tor
    - Only localhost connections visible

3. **Message Recipients:**

    - Hidden service addresses not exposed
    - No correlation between users

4. **Message Sizes:**
    - Padding obscures actual message lengths
    - Fixed-size packets prevent size analysis

## Security Measures Demonstrated

### Traffic Analysis Protection

**Padding Detection:**

-   Tool verifies messages are padded to fixed sizes (512B, 1KB, 2KB, 4KB)
-   Prevents attackers from inferring message content from size

**Timing Obfuscation:**

-   Detects random delays between messages (0.5-3 seconds)
-   Prevents timing correlation attacks

**Dummy Traffic:**

-   Identifies fake messages sent periodically
-   Obscures real communication patterns

### Anonymity Protection

**Tor Integration:**

-   Verifies all traffic routes through Tor network
-   Confirms no IP address leakage

**Circuit Management:**

-   Detects automatic circuit refresh (every 5 minutes)
-   Prevents long-term traffic correlation

### Correlation Attack Resistance

**Pattern Analysis:**

-   Tests for regular timing patterns
-   Identifies traffic bursts that could aid correlation
-   Assesses overall correlation risk (LOW/MEDIUM/HIGH)

## Interpreting Results

### Good Security Indicators

-   ✓ Tor processes running and configured securely
-   ✓ Padding detected in traffic analysis
-   ✓ No regular timing patterns
-   ✓ Low correlation attack risk
-   ✓ Security score 80+ (Grade B or better)

### Security Concerns

-   ✗ Regular timing patterns detected
-   ✗ No padding in messages
-   ✗ High correlation attack risk
-   ✗ Tor connectivity issues
-   ✗ Security score below 70 (Grade C or worse)

## Example Output

```
┌─ Anonymous Messenger Security Analysis ─┐
│ Demonstrating anonymity and security     │
│ measures                                 │
└──────────────────────────────────────────┘

Phase 1: Tor Infrastructure Analysis
┌─ Tor Infrastructure Analysis ─┐
│ Component     │ Status      │ Details                    │
│ Tor Process   │ ✓ Running   │ PID: 1234, Ports: [9050]  │
│ Configuration │ ✓ Secure    │ Ports: [9050, 9051]       │
│ SOCKS Proxy   │ ✓ Working   │ Tor network connectivity   │
└───────────────┴─────────────┴────────────────────────────┘

Phase 2: Network Traffic Analysis (60s)
┌─ Network Traffic Analysis ─┐
│ Metric          │ Value     │ Security Implication           │
│ Total Packets   │ 45        │ Traffic volume observable      │
│ Tor Packets     │ 42        │ Tor usage detectable          │
│ Avg Packet Size │ 1024.3    │ Size patterns may reveal padding │
│ Regular Timing  │ No        │ Regular patterns aid correlation │
│ Padding Detected│ Yes       │ Padding helps prevent size analysis │
└─────────────────┴───────────┴────────────────────────────────┘

Correlation Attack Risk: LOW

Recommendations:
• Current traffic patterns show good anonymity protection

Phase 3: Security Assessment
┌─ Security Assessment ─┐
│ Security Score: 95/100 │
│ Grade: A               │
│                        │
│ Factors affecting score:│
│ No security issues     │
│ detected               │
└────────────────────────┘
```

## Advanced Usage

### Custom Analysis

The tool can be extended for specific analysis:

```python
# Example: Custom correlation analysis
tester = SecurityTester()
results = tester.run_comprehensive_test(duration=120)

# Access raw packet data
packets = tester.network_analyzer.packets

# Custom analysis
for packet in packets:
    if packet['is_tor']:
        print(f"Tor packet: {packet['size']} bytes at {packet['timestamp']}")
```

### Integration with Other Tools

**Wireshark Integration:**

```bash
# Capture to file for Wireshark analysis
sudo tcpdump -i lo -w messenger_traffic.pcap &
python3 anon_messenger.py --server
# Stop tcpdump and analyze in Wireshark
```

**Network Monitoring:**

```bash
# Monitor network connections
netstat -tulpn | grep tor
ss -tulpn | grep 9050
```

## Limitations

1. **Local Analysis Only**: Tool analyzes local traffic, not global network correlation
2. **Simulated Attacks**: Real-world attacks may be more sophisticated
3. **Platform Dependent**: Some features require specific OS capabilities
4. **Root Required**: Packet capture needs elevated privileges

## Security Considerations

-   Run in isolated environment for testing
-   Tool itself generates network traffic
-   Packet capture may expose other system traffic
-   Use only for authorized testing and research

## Troubleshooting

### Common Issues

**Permission Denied:**

```bash
# Solution: Run with sudo
sudo python3 pentest_anon_messenger.py
```

**No Packets Captured:**

```bash
# Check interface name
ip addr show
# Use correct interface
sudo python3 pentest_anon_messenger.py --interface eth0
```

**Tor Not Detected:**

```bash
# Start Tor manually
tor &
# Or use system Tor
sudo systemctl start tor
```

**Import Errors:**

```bash
# Install missing dependencies
pip install -r pentest_requirements.txt
```

## Contributing

Improvements welcome for:

-   Additional attack simulations
-   Enhanced correlation analysis
-   Better visualization
-   Cross-platform compatibility

## Disclaimer

This tool is for educational and research purposes only. Use only on systems you own or have explicit permission to test. The authors are not responsible for misuse of this tool.
